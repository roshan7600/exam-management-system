{% extends 'base.html' %}

{% block title %}Login - Exam Management System{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center align-items-center min-vh-100">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-sign-in-alt fa-3x text-primary mb-3"></i>
                        <h3 class="card-title">Login</h3>
                        <p class="text-muted">Sign in to your account</p>
                    </div>
                    
                    <form method="post" novalidate>
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-user"></i>
                                </span>
                                <input
                                  type="text"
                                  class="form-control"
                                  id="username"
                                  name="username"
                                  required
                                  minlength="3"
                                  maxlength="15"
                                  pattern="^[a-zA-Z0-9._]+$"
                                  title="Only letters, numbers, dots, and underscores allowed (3-15 chars)"
                                >
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="password" class="form-label">Password</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-lock"></i>
                                </span>
                                <input
                                  type="password"
                                  class="form-control"
                                  id="password"
                                  name="password"
                                  required
                                  minlength="6"
                                  maxlength="12"
                                >
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </button>
                    </form>
                    
                    <div class="text-center">
                        <p class="mb-0">Don't have an account? 
                            <a href="{% url 'register' %}" class="text-primary">Register here</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  const form = document.querySelector('form');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');

  usernameInput.addEventListener('input', () => {
    const val = usernameInput.value;
    const regex = /^[a-zA-Z0-9._]{0,15}$/;
    if (!regex.test(val)) {
      usernameInput.setCustomValidity('Only letters, numbers, dots, and underscores allowed (max 15 chars).');
    } else if (val.length > 0 && val.length < 3) {
      usernameInput.setCustomValidity('Username must be at least 3 characters.');
    } else {
      usernameInput.setCustomValidity('');
    }
  });

  passwordInput.addEventListener('input', () => {
    const val = passwordInput.value;
    if (val.length < 6 || val.length > 12) {
      passwordInput.setCustomValidity('Password must be between 6 and 12 characters.');
    } else {
      passwordInput.setCustomValidity('');
    }
  });

  form.addEventListener('submit', (e) => {
    usernameInput.dispatchEvent(new Event('input'));
    passwordInput.dispatchEvent(new Event('input'));

    if (!form.checkValidity()) {
      e.preventDefault();
      form.reportValidity();
    }
  });
</script>
{% endblock %}
